<!doctype html>

<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <title>US Major League Soccer Betting Odds</title>
    
  </head>
  <div class="row">
    <div class="col-md-1">
    </div>
    <div class="col-md-10">
      <h1 style="font-size:60px; color:black;">US Major League Soccer Betting Odds</h1>
      <body style="background-color:white;">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
          
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-light " style="background-color:lightblue;">
  <!-- Container wrapper -->
  <div class="container-fluid">

    <!-- Toggle button -->
    <button class="navbar-toggler" type="button" data-mdb-toggle="collapse" data-mdb-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Collapsible wrapper -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent" >
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">

        <!-- Link -->
        <li class="nav-item">
          <a class="nav-link" href="index.html">Home</a>
        </li>
          <li class="nav-item">
            <a class="nav-link" href="about.html">The Teams</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="sports.html">Learn The Odds!</a>
      </li>

      </ul>
              
          </div>
                         
        </nav>
      </header>
</body>



        <div class="container">
            &nbsp
            &nbsp
            &nbsp
            &nbsp
            &nbsp

        <br><br>
  

        <h3>Inputs "work in progress - Sorin"</h3>



    <div>
        <label>The Odds API Key:</label>
        <input type="text" name="api-key" id="my-api-key" placeholder="Betting API Key" value="e72f1251b3be1811c37ed5e6daa2519f">
        <br>

        <label>Your Favorite MLS Team:</label>
        <select id="my-team-selector">
            <option value="DC United" selected>DC United</option>            
            <option value="Atlanta United FC"> Atlanta United FC</option>            
            <option value='Chicago Fire FC'>Chicago Fire FC</option>
            <option value='FC Cincinnati'>FC Cincinnati</option>
            <option value='Columbus Crew SC'>Columbus Crew SC</option>
            <option value='Inter Miami CF'>Inter Miami CF</option>
            <option value='CF Montréal'>CF Montréal</option>
            <option value='Nashville SC'>Nashville SC</option>
            <option value='New England Revolution'>New England Revolution</option>
            <option value='New York City FC'>New York City FC</option>
            <option value='New York Red Bulls'>New York Red Bulls</option>
            <option value='Orlando City SC'>Orlando City SC</option>
            <option value='Philadelphia Union'>Philadelphia Union</option>
            <option value='Toronto FC'>Toronto FC</option>
            <option value='Austin FC'>Austin FC</option>
            <option value='Colorado Rapids'>Colorado Rapids</option>
            <option value='FC Dallas'>FC Dallas</option>
            <option value='Houston Dynamo FC'>Houston Dynamo FC</option>
            <option value='Sporting Kansas City'>Sporting Kansas City</option>
            <option value='LA Galaxy'>LA Galaxy</option>
            <option value='Los Angeles FC'>Los Angeles FC</option>
            <option value='Minnesota United FC'>Minnesota United FC</option>
            <option value='Portland Timbers'>Portland Timbers</option>
            <option value='Real Salt Lake'>Real Salt Lake</option>
            <option value='San Jose Earthquakes'>San Jose Earthquakes</option>
            <option value='Seattle Sounders FC'>Seattle Sounders FC</option>
            <option value='Vancouver Whitecaps FC'>Vancouver Whitecaps FC</option>

        </select>
        <br>

        <button id="my-submit-btn">Go!</button>
    </div>

    <hr>

    <h2>Outputs</h2>

    <div>
        <p>Selected Team: <span id="display-team">_____________</span></p>
        <p>Latest Odds: <span id="display-latest-odds">__________</span></p>
    </div>

    <div id="dataviz-container"></div>

    
    <script type="text/javascript">

        //
        // When the button is clicked:
        // ... 1) capture input values
        // ... 2) compile the right URL given the provided inputs
        // ... 3) fetch data from that URL
        // ... 4) crunch the data
        // ... 5) overwrite the HTML display values (team, latest close)
        // ... 6) make a dataviz
        //
        var team, apiKey, dates, closingPrices;
        var inputApiKey = document.getElementById("my-api-key");
        var inputSelect = document.getElementById("my-team-selector");
        document.getElementById("my-submit-btn").onclick = function() {
            team = inputSelect.value;
            document.getElementById("display-team").innerHTML = team;
            apiKey = inputApiKey.value;
            var requestUrl = "https://api.the-odds-api.com/v3/odds/?sport=soccer_usa_mls&region=us&mkt=h2h&dateFormat=iso" +"&apiKey=" + apiKey
            console.log("REQUEST URL:", requestUrl);
            fetch(requestUrl)
                .then(response => {
                    console.log("RESPONSE", response)
                    return response.json()
                })
                .then(data => {
                    //console.log("DATA", data) // this is the data you're looking for
                    dates = Object.keys(data["Time Series (Daily)"]);
                    var priceData = Object.values(data["Time Series (Daily)"]);
                    closingPrices = priceData.map(x => x["4. close"]);
                    //console.log(closingPrices);
                    document.getElementById("display-latest-odds").innerHTML = closingPrices[0];
                    var trace1 = {
                        x: dates,
                        y: closingPrices,
                        mode: 'lines'
                    };                   

                    var data = [ trace1 ];

                    var layout = {
                        title:'Closing prices of ' + team
                    };

                    Plotly.newPlot('dataviz-container', data, layout);
                })
                .catch(err => {
                    console.error("FETCH ERR", err)
                })

        };
        

        console.log("TODO: RESPOND TO BUTTON CLICKS AND CAPTURE FORM INPUTS")

        //var apiKey = "TODO"
        //var team = "TODO"
        var requestUrl = "https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&team=" + team + "&apikey=" + apiKey
        console.log("REQUEST URL:", requestUrl)

        console.log("TODO: FETCH DATA")

        console.log("TODO: DISPLAY DATA")

        console.log("TODO: DATAVIZ")

    </script>
        </div>
</body>
</html>

